---
title: "가중치에 MCP penalty가 적용된 신경망 모형을 구현해보자!"
excerpt: "custom kernel regularizer를 구현하기"
toc: true
toc_sticky: true

author_profile: false
use_math: true

date: 2021-09-07 20:00:00 -0000
categories: 
  - tensorflow 2.0
tags:
  - tensorflow 2.0
  - keras
  - custom modeling
---

## MCP penalty
Minimax Concave Penalty

$$
\begin{aligned} 
P_r(x;\lambda) = \begin{cases} \lambda \vert x \vert - \frac{x^2}{2r} \text{\quad if } \vert x \vert \leq r \lambda \\
\frac{r \lambda^2}{2} \text{\quad if } \vert x \vert > r \lambda \end{cases}
\end{aligned}
$$

이를 파이썬 함수로 구현하면 다음과 같다.

```python
@tf.function
def  MCP(weight,  lambda_,  r):
	penalty1 = lambda_ *  tf.abs(weight)  -  tf.math.square(weight)  / (2.  * r)
	penalty2 =  tf.math.square(lambda_)  * r /  2
	return  tf.reduce_sum(penalty1 * tf.cast(tf.abs(weight)  <= r * lambda_, tf.float32)  + penalty2 * tf.cast(tf.abs(weight)  > r * lambda_, tf.float32))
```


<center><img  src="https://github.com/an-seunghwan/an-seunghwan.github.io/blob/master/assets/img/mcp.png?raw=true" width="450"  height="300"></center>


<!--stackedit_data:
eyJoaXN0b3J5IjpbLTg2MzkxMzk2NCwxNDA3Nzc5MDRdfQ==
-->